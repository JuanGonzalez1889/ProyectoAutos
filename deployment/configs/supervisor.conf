# ===================================================================
# CONFIGURACIÓN SUPERVISOR PARA QUEUE WORKERS
# ===================================================================
# Ubicación: /etc/supervisor/conf.d/laravel-worker.conf
# ===================================================================

[program:laravel-worker]

; Nombre del proceso (incluye número de proceso)
process_name=%(program_name)s_%(process_num)02d

; Comando a ejecutar
command=php /var/www/autoweb-pro/artisan queue:work redis --sleep=3 --tries=3 --max-time=3600 --timeout=300

; Iniciar automáticamente
autostart=true

; Reiniciar automáticamente si falla
autorestart=true

; Detener todo el grupo de procesos si uno falla
stopasgroup=true

; Enviar SIGKILL a todos los procesos del grupo
killasgroup=true

; Usuario que ejecuta el worker
user=www-data

; Número de procesos a ejecutar
numprocs=4

; Redirect stderr to stdout
redirect_stderr=true

; Log file
stdout_logfile=/var/www/autoweb-pro/storage/logs/worker.log

; Log file max size (50MB)
stdout_logfile_maxbytes=50MB

; Mantener 10 archivos de log rotados
stdout_logfile_backups=10

; Tiempo máximo para esperar antes de SIGKILL (1 hora)
stopwaitsecs=3600

; Prioridad de inicio
priority=999

; ===================================================================
# COMANDOS ÚTILES DE SUPERVISOR
# ===================================================================
# sudo supervisorctl reread          - Leer cambios de configuración
# sudo supervisorctl update          - Aplicar cambios
# sudo supervisorctl start laravel-worker:*    - Iniciar todos los workers
# sudo supervisorctl stop laravel-worker:*     - Detener todos los workers
# sudo supervisorctl restart laravel-worker:*  - Reiniciar todos los workers
# sudo supervisorctl status          - Ver estado de todos los procesos
# sudo supervisorctl tail laravel-worker:laravel-worker_00 - Ver logs en tiempo real
# ===================================================================
